apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kubernetes-database-backup.fullname" . }}-configs
  labels:
    {{- include "kubernetes-database-backup.labels" . | nindent 4 }}
data:
  {{- range $dbType, $dbDetail := $.Values }}
  {{- if and (kindIs "map" $dbDetail) ($dbDetail.enabled) (hasKey $dbDetail "instances") }}
  {{ $dbType }}.yaml: |
    {{ $dbType }}:
    {{- range $instance := $dbDetail.instances }}
    - hostname: {{ .hostname }}
      namespace: {{ .namespace }}
      {{- if hasKey $instance "port" }}
      port: {{ $instance.port }}
      {{- end }}
      {{- if hasKey $instance "database" }}
      database: {{ $instance.database }}
      {{- end }}
    {{- end }}
  {{- end }}
  {{- end }}